# Lab4 实验报告

-   PB17111568
-   郭雨轩

## 补全表格

| BTB  | BHT  | REAL | NPC-PRED | flush | NPC-REAL | BTB-UPADTE |
| :--: | :--: | :--: | :------: | :---: | :------: | :--------: |
|  Y   |  Y   |  Y   |   BUF    |   N   |   BUF    |     N      |
|  Y   |  Y   |  N   |   BUF    |   Y   | PC-EX+4  |     N      |
|  Y   |  N   |  Y   | PC-IF+4  |   Y   |   BUF    |     N      |
|  Y   |  N   |  N   | PC-IF+4  |   N   | PC-EX+4  |     N      |
|  N   |  Y   |  Y   | PC-IF+4  |   Y   |  BrNPC   |     Y      |
|  N   |  Y   |  N   | PC-IF+4  |   N   | PC-EX+4  |     N      |
|  N   |  N   |  Y   | PC-IF+4  |   Y   |  BrNPC   |     Y      |
|  N   |  N   |  N   | PC-IF+4  |   N   | PC-EX+4  |     N      |

## 实验结果分析

假定在所执行的代码中，共执行$x$次分支指令，一旦分支预测命中可带来2个时钟周期的收益，预测失败则无收益，假定预测成功的概率为$\alpha$，那么总的收益为：$T=x\cdot \alpha \cdot 2$。下面对四个测试样例进行分析

### btb.S

|       | 无分支预测执行周期数 | 有分支预测执行周期数 | 分支指令数 | 分支预测错误数 |
| :---: | :------------------: | :------------------: | :--------: | :------------: |
| 1-bit |         508          |         311          |    101     |       2        |
| 2-bit |         508          |         313          |    101     |       3        |

### bht.S

|       | 无分支预测执行周期数 | 有分支预测执行周期数 | 分支指令数 | 分支预测错误数 |
| :---: | :------------------: | :------------------: | :--------: | :------------: |
| 1-bit |         533          |         379          |    110     |       22       |
| 2-bit |         533          |         365          |    110     |       15       |

### qsort256.S

|       | 无分支预测执行周期数 | 有分支预测执行周期数 | 分支指令数 | 分支预测错误数 |
| :---: | :------------------: | :------------------: | :--------: | :------------: |
| 1-bit |        42788         |        40358         |   10398    |      2021      |
| 2-bit |        42788         |        37980         |   10398    |      1449      |

### matmul16.S

|       | 无分支预测执行周期数 | 有分支预测执行周期数 | 分支指令数 | 分支预测错误数 |
| :---: | :------------------: | :------------------: | :--------: | :------------: |
| 1-bit |        333180        |        331446        |    4912    |      786       |
| 2-bit |        333180        |        330273        |    4912    |      533       |

（分支预测正确数为分支指令数减去分支预测错误数）

### 分支预测结果分析

在所有的测试中，使用2bits-BHT的分支预测错误数均比BTB要低，完成代码所需的时钟周期数均比1bit要短但是对周期数的提升均较小，当出现cache miss时，所消耗的时间更多。